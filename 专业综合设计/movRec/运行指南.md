# 电影推荐系统 - 运行指南

## 快速开始

### 第一步：确保MongoDB运行

**Windows:**
```bash
# 检查MongoDB服务是否运行
net start MongoDB

# 如果未运行，启动MongoDB
net start MongoDB
```

**Linux/Mac:**
```bash
# 检查MongoDB状态
sudo systemctl status mongodb
# 或
ps aux | grep mongod

# 如果未运行，启动MongoDB
sudo systemctl start mongodb
# 或
mongod --dbpath /path/to/data
```

### 第二步：安装爬虫依赖（首次运行）

```bash
cd movie_recommendation

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装新依赖（beautifulsoup4, requests, lxml）
pip install beautifulsoup4 requests lxml
```

### 第三步：启动后端服务器

**方式1：使用启动脚本（推荐）**

**Windows:**
```bash
start_backend.bat
```

**Linux/Mac:**
```bash
chmod +x start_backend.sh
./start_backend.sh
```

**方式2：手动启动**
```bash
cd movie_recommendation

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 初始化数据库索引
python manage.py init_db

# 启动服务器
python manage.py runserver 0.0.0.0:8000
```

看到以下信息说明启动成功：
```
Starting development server at http://0.0.0.0:8000/
Quit the server with CTRL-BREAK.
```

### 第四步：启动前端服务器

**方式1：使用启动脚本**

**Windows:**
```bash
# 新开一个命令行窗口
start_frontend.bat
```

**Linux/Mac:**
```bash
# 新开一个终端
chmod +x start_frontend.sh
./start_frontend.sh
```

**方式2：手动启动**
```bash
cd frontend

# 使用Python HTTP服务器
python -m http.server 3000

# 或使用Node.js（如果已安装）
npx http-server -p 3000 -c-1
```

**方式3：直接打开（不推荐，可能有CORS问题）**
直接用浏览器打开 `frontend/index.html` 文件

### 第五步：访问网站

打开浏览器访问：
- **前端**: http://localhost:3000
- **后端API文档**: http://localhost:8000/api/docs/

## 爬取电影数据（可选但推荐）

### 首次运行建议先爬取一些电影数据

**方式1：爬取热门电影**
```bash
cd movie_recommendation

# 激活虚拟环境
venv\Scripts\activate  # Windows
# 或
source venv/bin/activate  # Linux/Mac

# 爬取20部热门电影
python manage.py crawl_movies
```

**方式2：根据关键词搜索并爬取**
```bash
# 爬取特定电影
python manage.py crawl_movies --keywords "The Matrix" "Inception" "Interstellar"

# 爬取动作片
python manage.py crawl_movies --keywords "action movie" --limit 30
```

**方式3：批量爬取热门电影**
```bash
# 爬取50部热门电影
python manage.py crawl_movies --limit 50
```

### 爬取完成后

刷新前端页面（http://localhost:3000），就能看到：
- 电影海报图片
- 电影简介
- 完整的电影信息

## 验证系统运行

### 1. 检查后端
访问 http://localhost:8000/api/health
应该返回：`{"status":"ok","mongo":true}`

### 2. 检查前端
访问 http://localhost:3000
应该看到电影推荐网站首页

### 3. 检查API文档
访问 http://localhost:8000/api/docs/
应该看到Swagger API文档界面

## 常见问题

### Q1: MongoDB连接失败
**解决：**
```bash
# 检查MongoDB是否运行
# Windows: net start MongoDB
# Linux/Mac: sudo systemctl status mongodb

# 检查数据库名是否为 "movie"
# 在MongoDB shell中：
mongo
use movie
show collections
```

### Q2: 端口被占用
**解决：**
- 后端默认8000端口，如果被占用：
  - 修改 `start_backend.bat/sh` 中的端口号
  - 同时修改 `frontend/js/api.js` 中的 `API_BASE_URL`
- 前端默认3000端口，如果被占用：
  - 修改 `start_frontend.bat/sh` 中的端口号

### Q3: 爬虫无法连接IMDB
**解决：**
- 检查网络连接
- 如果在中国大陆，可能需要使用VPN
- 可以尝试使用代理

### Q4: 前端显示空白或错误
**解决：**
1. 检查后端是否正常运行
2. 打开浏览器开发者工具（F12）查看控制台错误
3. 检查 `frontend/js/api.js` 中的 `API_BASE_URL` 是否正确

### Q5: 没有电影数据
**解决：**
运行爬虫命令爬取电影数据：
```bash
python manage.py crawl_movies --limit 20
```

## 下一步

1. **注册账号** - 访问 http://localhost:3000，点击注册
2. **爬取电影** - 运行爬虫命令获取电影数据
3. **浏览电影** - 在首页查看电影列表
4. **查看详情** - 点击电影查看详情、发表评论
5. **使用推荐** - 登录后使用个性化推荐功能

## 提示

- 后端和前端需要分别在不同的命令行窗口/终端中运行
- 首次运行建议先爬取一些电影数据，这样前端才有内容显示
- 如果遇到问题，查看 `DEBUG.md` 获取详细排查步骤

