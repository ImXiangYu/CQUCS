# ğŸš€ ç”µå½±æ¨èç³»ç»Ÿéƒ¨ç½²æ€»ç»“ (Ubuntu 24.04)

## ğŸ—ï¸ æ•´ä½“æ¶æ„

- **å‰ç«¯æœåŠ¡å™¨**ï¼šNginx (Port 80) -> å¤„ç†é™æ€èµ„æº + åå‘ä»£ç†
- **åç«¯æœåŠ¡å™¨**ï¼šDjango (Port 8000) -> å¤„ç†ä¸šåŠ¡é€»è¾‘ + MongoDB æ•°æ®åº“
- **ç½‘ç»œç­–ç•¥**ï¼šåˆ©ç”¨ Nginx `/api` è½¬å‘è§£å†³è·¨åŸŸï¼Œå¹¶éšè—åç«¯çœŸå®ç«¯å£ã€‚
- **æœåŠ¡å™¨é…ç½®**ï¼š1vCPUs | 1GiB | x1.1u.1g | Ubuntu 24.04 server 64bit

------

## 1. åç«¯æœåŠ¡å™¨é…ç½® (Backend)

### ğŸ›  åŸºç¡€ç¯å¢ƒ

1. **æ›´æ–°ç³»ç»Ÿ**ï¼šå®‰è£… `build-essential` ç­‰åŸºç¡€ç¼–è¯‘å·¥å…·ã€‚
2. **å®‰è£… Python**ï¼šå®‰è£… `python3-pip` å’Œ `python3-venv`ã€‚
3. **å®‰è£… MongoDB**ï¼šç”±äº Ubuntu 24.04 å®˜æ–¹æºæš‚æ—  MongoDBï¼Œæˆ‘ä»¬é‡‡ç”¨äº† **Jammy (22.04) å®˜æ–¹æº** é™çº§å®‰è£…äº† MongoDB 7.0ï¼Œå¹¶æ‰‹åŠ¨è¡¥é½äº† `libssl1.1` ä¾èµ–ã€‚

### ğŸ“¦ é¡¹ç›®åˆå§‹åŒ–

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**ï¼šä½¿ç”¨ `python3 -m venv venv` éš”ç¦»ä¾èµ–ã€‚
2. **å®‰è£…ä¾èµ–**ï¼šå‡çº§ `pip` å¹¶å®‰è£… `requirements.txt` åŠçˆ¬è™«æ‰€éœ€åº“ï¼ˆ`lxml`, `bs4`ï¼‰ã€‚
3. **æ•°æ®åº“è¿ç§»**ï¼šè¿è¡Œ `python manage.py migrate` åˆå§‹åŒ– Django å†…ç½®è¡¨ã€‚
4. **åˆå§‹åŒ–ç´¢å¼•**ï¼šè¿è¡Œ `python manage.py init_db` è¿æ¥ MongoDBã€‚

### ğŸ”„ è‡ªåŠ¨åŒ–ä¸æŒä¹…åŒ–

- ç¼–å†™äº† `restart.sh` è„šæœ¬ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ **Python ç»å¯¹è·¯å¾„** å®ç°ä¸€é”®æ€æ­»æ—§è¿›ç¨‹å¹¶åå°ï¼ˆ`nohup`ï¼‰å¯åŠ¨ã€‚

------

## 2. å‰ç«¯æœåŠ¡å™¨é…ç½® (Frontend)

### ğŸŒ Nginx åå‘ä»£ç†

é…ç½® Nginx ç›‘å¬ 80 ç«¯å£ï¼Œå¹¶è®¾ç½®äº†å…³é”®çš„ `location /api/`ï¼š

- **åŠŸèƒ½**ï¼šå°†æ‰€æœ‰å‰ç«¯å‘å¾€ `/api/*` çš„è¯·æ±‚é™é»˜è½¬å‘è‡³ `åç«¯IP:8000/*`ã€‚
- **ä¼˜åŠ¿**ï¼šç»•è¿‡äº†æµè§ˆå™¨è·¨åŸŸé™åˆ¶ï¼Œè§£å†³äº†æœ¬åœ°è®¿é—®åç«¯ 8000 ç«¯å£æŠ¥ 502 çš„ç½‘ç»œç¯å¢ƒé—®é¢˜ã€‚

**Nginxé…ç½®ï¼š**

```nginx
server {
    listen 80;
    server_name _; # å¦‚æœæœ‰åŸŸåï¼Œè¯·å¡«å…¥åŸŸå

    # 1. é…ç½®å‰ç«¯é™æ€æ–‡ä»¶è·¯å¾„
    location / {
        root /var/www/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html; # æ”¯æŒå•é¡µåº”ç”¨è·¯ç”±
    }

    location /data/ {
        # æ³¨æ„ï¼šè¿™é‡Œæ¢æˆä½ æœåŠ¡å™¨ä¸Š movRec/data çš„ç»å¯¹è·¯å¾„
        alias /var/www/movRec/data/;
        autoindex on; # å¯é€‰ï¼šå…è®¸æŸ¥çœ‹ç›®å½•åˆ—è¡¨ï¼Œæ–¹ä¾¿è°ƒè¯•
    }

    # 2. é…ç½®åå‘ä»£ç†ï¼Œè§£å†³è·¨åŸŸå¹¶è¿æ¥è¿œç¨‹åç«¯
    # å‡è®¾ä½ çš„å‰ç«¯ä»£ç é€šè¿‡ /api è·¯å¾„è®¿é—®åç«¯
    location /api/ {
        proxy_pass http://101.245.85.214:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### âš™ï¸ ä»£ç é€‚é…

- **ä¿®æ”¹ API åœ°å€**ï¼šå°† `frontend/js/api.js` ä¸­çš„ `API_BASE_URL` ä»å…·ä½“çš„ IP æ”¹ä¸ºç›¸å¯¹è·¯å¾„ `/api`ã€‚

------

## 3. æ ¸å¿ƒè¿ç»´æŒ‡ä»¤é›†

| **ä»»åŠ¡**           | **å‘½ä»¤**                                       |
| ------------------ | ---------------------------------------------- |
| **é‡å¯åç«¯**       | `bash restart.sh`                              |
| **æŸ¥çœ‹åç«¯æ—¥å¿—**   | `tail -f backend.log`                          |
| **æ£€æŸ¥ç«¯å£å ç”¨**   | `sudo netstat -tpln | grep 8000`               |
| **é‡å¯å‰ç«¯ Nginx** | `sudo nginx -t && sudo systemctl reload nginx` |
| **MongoDB çŠ¶æ€**   | `sudo systemctl status mongod`                 |
| **çˆ¬å–æ•°æ®**       | `python manage.py crawl_movies --limit 20`     |

------

## âš ï¸ é¿å‘æŒ‡å— (Lessons Learned)

- **è™šæ‹Ÿç¯å¢ƒä¸å¯è·¨æœº**ï¼šä¸è¦ç›´æ¥ä¸Šä¼ æœ¬åœ° `venv`ï¼Œå¿…é¡»åœ¨æœåŠ¡å™¨ç«¯æ ¹æ® `requirements.txt` é‡æ–°æ„å»ºã€‚
- **502 é”™è¯¯æ’æŸ¥**ï¼šå½“å¤–ç½‘ 502 ä½†å†…ç½‘ curl æˆåŠŸæ—¶ï¼Œé€šå¸¸æ˜¯äº‘å®‰å…¨ç»„æœªå¼€æˆ–ç½‘å…³æ‹¦æˆªï¼Œæœ€ä¼˜è§£æ˜¯èµ° Nginx åå‘ä»£ç†ã€‚
- **ç»å¯¹è·¯å¾„å®‰å…¨**ï¼šåœ¨ç¼–å†™ Crontab æˆ– Shell è„šæœ¬æ—¶ï¼Œä½¿ç”¨ `venv/bin/python` çš„ç»å¯¹è·¯å¾„æ¯” `source venv/bin/activate` æ›´ç¨³å¥ã€‚